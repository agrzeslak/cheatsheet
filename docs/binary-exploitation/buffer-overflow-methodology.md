---
layout: default
title: Buffer Overflow Methodology
parent: Binary Exploitation
---

# Buffer Overflow Methodology
{: .no_toc }

## Table of contents
{: .no_toc .text-delta }

1. TOC
{:toc}

---

## Procedure
1. We want to control `EIP`. Send a unique string, check what `EIP` is and use it to determine the offset at which `EIP` is found.
2. Check how much buffer space we have after `EIP` (where `ESP` points) for shellcode. Need approx 350-400 bytes.
3. If there is not enough space for the shellcode, examine how the program is operating at the time of the crash. What are the values of the registers? What does the input provided cause the program to do? Using the limited space available, find a way to redirect execution to a location where there is more room for our buffer (shellcode).
4. Check for bad characters by sending all possible characters as a string in the buffer, then checking for anomolies such as truncation or ommission. This may need several runs, removing bad chars each time until all work.
5. Check if any registers can help us reach our buffer (if any registers point to the beginning of our buffer, or close to it).
6. Find a reliable way of returning to the register which contains the address of our buffer (and hence the buffer itself) as it may change each run. E.g. a reliable address in memory with an instruction such as `JMP ESP` if `ESP` points to our buffer. Ensure that DEP and ALSR and disabled for the section of code we will use. Also search by the equivalent opcode.
    - If DEP is enabled, the section of code we use must have both read and execute permissions
7. Ensure that the chosen address does not include any bad characters.
8. Set `EIP` to the chosen address so that the buffer is executed.
9. Generate shellcode to place within the buffer, avoiding bad characters.
10. The shellcode has a decoder that will use registers such as `ESP` as part of decoding. If the shellcode is at `ESP` for example, we need to add `NOP`/`0x90` instructions to the beginning of the shellcode so that there is room for the decoder to execute without overwriting the beginning of our shellcode. Try 8 and increase from there.
11. Done.

## collapsible markdown?

- <details><summary/>
## Header
```shell
id
```
</details>
