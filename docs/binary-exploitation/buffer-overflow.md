---
layout: default
title: Buffer Overflow
parent: Binary Exploitation
---

# Buffer Overflow
{: .no_toc }

## Table of contents
{: .no_toc .text-delta }

1. TOC
{:toc}

---

## Registers
- `ESP` Extended Stack Pointer - top of running processes' stack
- `EIP` Extended Instruction Pointer - address of instruction being executed

64-bit | Low 32 bits | Low 16 bits | High 8 bits | Low 8 bits | Description
--- | --- | --- | --- | --- | ---
rax | eax | ax | ah | al | Accumulator (arithmatics)
rbx | ebx | bx | bh | bl | Base (pointer to data)
rcx | ecx | cx | ch | cl | Counter (shift/rotate instr & loops)
rdx | edx | dx | dh | dl | Data (arithmatics and I/O)
rsi | esi | si | | sil | Source in stream ops
rdi | edi | di | | dil | Destination in stream ops
rbp | ebp | bp | | bpl | Base of stack
rsp | esp | sp | | spl | Top of stack
r8 | r8d | r8w | | r8b | 
r9 | r9d | r9w | | r9b | 
r10 | r10d | r10w | | r10b | 
r11 | r11d | r11w | | r11b | 
r12 | r12d | r12w | | r12b | 
r13 | r13d | r13w | | r13b | 
r14 | r14d | r14w | | r14b | 
r15 | r15d | r15w | | r15b | 

---

## Tools
Unique buffer string
```shell
pattern_create.rb <length of string (bytes)>  # Generate unique string
pattern_offset.rb <hex string to match>       # Locate offset of hex value within string
```

Convert instructions to op codes
```shell
nasm_shell.rb
```

---

## Bad Characters
Common bad characters:
- `00` null byte (terminates strings and hence truncates payload)
- `0D` carraige return (can terminate fields such as password inputs where return terminates it)

---

## Concepts
### ASLR
- Address Space Layout Randomisation
- Randomly offsets the location of modules and in-memory structures
- Aims to prevent exploits from reliably locating sections of code
- Can be bypassed if the location of certain memory regions (especially DLL mappings) can be predicted, controlled or discovered
- Absence of DEP can allow the use of heap spraying to place code in predictable locations

### DEP
- Data Execution Prevention
- Prevents areas of memory such as the stack from being executed
- In most cases is not robust enough without ASLR
